{"version":3,"sources":["../src/generate_report.js"],"names":["define","$","Ajax","Str","Notification","GenerateReport","requestorId","userId","userName","contextId","parseInt","start","end","timer","file","formdata","polling","click","e","preventDefault","startDate","val","endDate","completion","checkCompletion","alert","get_string","requestorid","userid","username","contextid","call","methodname","args","jsonformdata","JSON","stringify","done","addClass","html","that","setInterval","pollFile","bind","fail","exception","prototype","length","data","status","removeClass","path","clearInterval","generateReport"],"mappings":"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","sourcesContent":["define(['jquery',\n        'core/ajax',\n        'core/str',\n        'core/notification'], function($, Ajax, Str, Notification) {\n    \"use strict\";\n\n    var GenerateReport = function(requestorId, userId, userName, contextId) {\n        this.requestorId = parseInt(requestorId);\n        this.userId = parseInt(userId);\n        this.userName = userName;\n        this.start = null;\n        this.end = null;\n        this.contextId = contextId;\n        this.timer = 2500;\n        this.file = false;\n        this.formdata = {};\n        this.polling = null;\n\n        $('#submitdate').click(function(e) {\n            e.preventDefault();\n\n            var startDate = $('#startInput').val();\n            var endDate = $('#endInput').val();\n            var completion = this.checkCompletion(startDate, endDate);\n            if (!completion) {\n                return Notification.alert(\n                    Str.get_string('error'), \n                    Str.get_string('error:completiondates', 'tool_time_report')\n                );\n            }\n\n            var formdata = {\n                requestorid: this.requestorId,\n                userid: this.userId,\n                username: this.userName,\n                start: $('#startInput').val(),\n                end: $('#endInput').val(),\n                contextid: this.contextId\n            };\n            this.formdata = formdata;\n\n            Ajax.call([{\n                methodname: 'tool_time_report_generate_time_report',\n                args: { jsonformdata: JSON.stringify(formdata) },\n                done: function() {\n                    $('#report-area').addClass('alert-warning')\n                        .html('<div class=\"spinner-border text-warning\" role=\"status\"></div> Chargement du rapport...');\n                    var that = this;\n                    (function foo() {\n                        that.polling = setInterval(pollFile.bind(that), 7500);\n                    })();\n                }.bind(this),\n                fail: Notification.exception\n            }]);\n        }.bind(this));\n    };\n\n    GenerateReport.prototype.checkCompletion = function(startDate, endDate) {\n        if (startDate.length == 0||endDate.length == 0) {\n            return false;\n        }\n        return true;\n    };\n\n    var pollFile = function() {\n        Ajax.call([{\n            methodname: 'tool_time_report_poll_report_file',\n            args: { jsonformdata: JSON.stringify(this.formdata) },\n            done: function(data) {\n                if (data.status == true) {\n                    $('#report-area').removeClass('alert-warning').addClass('alert-success')\n                        .html('<a href=\"'+data.path+'\" target=\"_blank\"><i class=\"fa fa-download\"></i> Télécharger le rapport</a>');\n                    clearInterval(this.polling);\n                    return;\n                }\n            }.bind(this),\n            fail: Notification.exception\n        }]);\n    };\n\n    return {\n        generateReport: function(requestorId, userId, userName, contextId) {\n            return new GenerateReport(requestorId, userId, userName, contextId);\n        }\n    };\n});"],"file":"generate_report.min.js"}