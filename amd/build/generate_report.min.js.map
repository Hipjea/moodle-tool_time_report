{"version":3,"sources":["../src/generate_report.js"],"names":["define","$","Ajax","Notification","GenerateReport","requestorId","userId","contextId","parseInt","start","end","timer","file","formdata","polling","click","e","preventDefault","startDate","val","endDate","completion","checkCompletion","alert","requestorid","userid","contextid","call","methodname","args","jsonformdata","JSON","stringify","done","addClass","html","that","setInterval","pollFile","bind","fail","exception","prototype","length","data","status","removeClass","path","clearInterval","generateReport"],"mappings":"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","sourcesContent":["define(['jquery',\n        'core/ajax',\n        'core/notification'], function($, Ajax, Notification) {\n    \"use strict\";\n\n    var GenerateReport = function(requestorId, userId, contextId) {\n        this.requestorId = parseInt(requestorId);\n        this.userId = parseInt(userId);\n        this.start = null;\n        this.end = null;\n        this.contextId = contextId;\n        this.timer = 2500;\n        this.file = false;\n        this.formdata = {};\n        this.polling = null;\n\n        $('#submitdate').click(function(e) {\n            e.preventDefault();\n\n            var startDate = $('#startInput').val();\n            var endDate = $('#endInput').val();\n            var completion = this.checkCompletion(startDate, endDate);\n            if (!completion) {\n                return Notification.alert(\"Erreur\", \"Saisir les dates de début et de fin de période.\");\n            }\n\n            var formdata = {\n                requestorid: this.requestorId,\n                userid: this.userId,\n                start: $('#startInput').val(),\n                end: $('#endInput').val(),\n                contextid: this.contextId\n            };\n            this.formdata = formdata;\n\n            Ajax.call([{\n                methodname: 'tool_time_report_generate_time_report',\n                args: { jsonformdata: JSON.stringify(formdata) },\n                done: function() {\n                    $('#report-area').addClass('alert-warning')\n                        .html('<div class=\"spinner-border text-warning\" role=\"status\"></div> Chargement du rapport...');\n                    var that = this;\n                    (function foo() {\n                        that.polling = setInterval(pollFile.bind(that), 7500);\n                    })();\n                }.bind(this),\n                fail: Notification.exception\n            }]);\n        }.bind(this));\n    };\n\n    GenerateReport.prototype.checkCompletion = function(startDate, endDate) {\n        if (startDate.length == 0||endDate.length == 0) {\n            return false;\n        }\n        return true;\n    };\n\n    var pollFile = function() {\n        Ajax.call([{\n            methodname: 'tool_time_report_poll_report_file',\n            args: { jsonformdata: JSON.stringify(this.formdata) },\n            done: function(data) {\n                if (data.status == true) {\n                    $('#report-area').removeClass('alert-warning').addClass('alert-success')\n                        .html('<a href=\"'+data.path+'\" target=\"_blank\"><i class=\"fa fa-download\"></i> Télécharger le rapport</a>');\n                    clearInterval(this.polling);\n                    return;\n                }\n            }.bind(this),\n            fail: Notification.exception\n        }]);\n    };\n\n    return {\n        generateReport: function(requestorId, userId, contextId) {\n            return new GenerateReport(requestorId, userId, contextId);\n        }\n    };\n});"],"file":"generate_report.min.js"}